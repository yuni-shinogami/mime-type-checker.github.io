<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MP3ãƒ•ã‚¡ã‚¤ãƒ«å†ç”Ÿãƒ†ã‚¹ãƒˆ - ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è©³ç´°åˆ†æ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5rem;
        }
        
        .browser-info {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .audio-section {
            margin: 30px 0;
            padding: 25px;
            border: 2px solid #ddd;
            border-radius: 12px;
            background: linear-gradient(to bottom, #fafafa, #f0f8ff);
        }
        
        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .audio-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .control-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            min-width: 80px;
        }
        
        .control-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .volume-slider {
            width: 100px;
            cursor: pointer;
        }
        
        .metadata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .metadata-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .metadata-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .metadata-card h4 {
            margin-top: 0;
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .metadata-item {
            margin: 12px 0;
            padding: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px dotted #ccc;
        }
        
        .metadata-label {
            font-weight: bold;
            color: #555;
        }
        
        .metadata-value {
            color: #333;
            background: #f8f9fa;
            padding: 6px 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .waveform-container {
            margin: 20px 0;
            padding: 20px;
            background: #1a1a2e;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .waveform {
            width: 100%;
            height: 80px;
            background: repeating-linear-gradient(
                90deg,
                #4ecdc4 0px,
                #4ecdc4 2px,
                transparent 2px,
                transparent 6px
            );
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        
        .waveform-progress {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #feca57);
            width: 0%;
            transition: width 0.1s ease;
            border-radius: 4px 0 0 4px;
        }
        
        .time-display {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-family: monospace;
            font-size: 1.1em;
            color: #555;
        }
        
        .status {
            padding: 12px;
            margin: 12px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b3d7ff;
        }
        
        .frequency-analyzer {
            margin: 20px 0;
            padding: 20px;
            background: #16213e;
            border-radius: 10px;
            color: white;
        }
        
        .frequency-bars {
            display: flex;
            justify-content: space-between;
            align-items: end;
            height: 100px;
            gap: 2px;
            margin: 15px 0;
        }
        
        .freq-bar {
            background: linear-gradient(to top, #ff6b6b, #4ecdc4);
            width: 8px;
            min-height: 2px;
            border-radius: 4px 4px 0 0;
            transition: height 0.1s ease;
        }
        
        .advanced-tests {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 10px;
            color: white;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .test-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #4a5568;
        }
        
        .audio-format-badge {
            display: inline-block;
            background: #ff6b6b;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 11px;
            margin: 2px;
            font-weight: bold;
        }
        
        .equalizer {
            display: flex;
            justify-content: center;
            align-items: end;
            height: 60px;
            gap: 3px;
            margin: 15px 0;
            padding: 10px;
            background: #1a1a2e;
            border-radius: 8px;
        }
        
        .eq-bar {
            width: 12px;
            background: linear-gradient(to top, #4ecdc4, #44a08d);
            border-radius: 6px;
            transition: height 0.2s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ MP3ãƒ•ã‚¡ã‚¤ãƒ«è©³ç´°åˆ†æãƒ†ã‚¹ãƒˆ</h1>
        <p style="text-align: center; color: #666; font-size: 1.1em;">
            é«˜å“è³ªã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ•ã‚¡ã‚¤ãƒ«ã®åŒ…æ‹¬çš„ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾— & å†ç”Ÿåˆ†æ
        </p>
        
        <!-- ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ± -->
        <div class="browser-info">
            <h3>ğŸ–¥ï¸ ãƒ–ãƒ©ã‚¦ã‚¶ãƒ»ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚µãƒãƒ¼ãƒˆæƒ…å ±</h3>
            <div id="browserInfo">æ¤œå‡ºä¸­...</div>
            <div style="margin-top: 10px;">
                <div class="audio-format-badge">MP3å¯¾å¿œ</div>
                <div class="audio-format-badge">AACå¯¾å¿œ</div>
                <div class="audio-format-badge">Web Audio API</div>
            </div>
        </div>
        
        <!-- MP3ãƒ•ã‚¡ã‚¤ãƒ«å†ç”Ÿãƒ†ã‚¹ãƒˆ -->
        <div class="audio-section">
            <h3>ğŸ¶ MP3ãƒ•ã‚¡ã‚¤ãƒ«å†ç”Ÿ & ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ</h3>
            <p><strong>ãƒ†ã‚¹ãƒˆç”¨MP3ãƒ•ã‚¡ã‚¤ãƒ«:</strong> file_example_MP3_700KB.mp3</p>
            
            <audio id="mp3Audio" class="audio-player" controls preload="metadata">
                <source src="file_example_MP3_700KB.mp3" type="audio/mpeg">
                ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯MP3ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚
            </audio>
            
            <!-- ã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
            <div class="audio-controls">
                <button class="control-btn" id="playPauseBtn">â–¶ï¸ å†ç”Ÿ</button>
                <button class="control-btn" id="stopBtn">â¹ï¸ åœæ­¢</button>
                <button class="control-btn" id="rewindBtn">âª å·»æˆ»ã—</button>
                <button class="control-btn" id="forwardBtn">â© æ—©é€ã‚Š</button>
                <div class="volume-control">
                    <span>ğŸ”Š</span>
                    <input type="range" id="volumeSlider" class="volume-slider" min="0" max="1" step="0.1" value="1">
                    <span id="volumeDisplay">100%</span>
                </div>
            </div>
            
            <!-- æ³¢å½¢ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ï¼ˆç–‘ä¼¼ï¼‰ -->
            <div class="waveform-container">
                <h4 style="color: white; margin-top: 0;">ğŸŒŠ ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªæ³¢å½¢ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼</h4>
                <div class="waveform">
                    <div class="waveform-progress" id="waveformProgress"></div>
                </div>
                <div class="time-display">
                    <span id="currentTime">0:00</span>
                    <span id="totalTime">0:00</span>
                </div>
            </div>
            
            <div id="playbackStatus" class="status info">
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: èª­ã¿è¾¼ã¿ä¸­...
            </div>
        </div>
        
        <!-- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è©³ç´°è¡¨ç¤º -->
        <div class="metadata-grid">
            <!-- åŸºæœ¬ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªæƒ…å ± -->
            <div class="metadata-card">
                <h4>ğŸµ åŸºæœ¬ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªæƒ…å ±</h4>
                <div class="metadata-item">
                    <span class="metadata-label">å†ç”Ÿæ™‚é–“:</span>
                    <span class="metadata-value" id="duration">å–å¾—ä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º:</span>
                    <span class="metadata-value">700 KB</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">å½¢å¼:</span>
                    <span class="metadata-value">MP3 (MPEG Audio Layer 3)</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">MIMEã‚¿ã‚¤ãƒ—:</span>
                    <span class="metadata-value" id="mimeType">audio/mpeg</span>
                </div>
            </div>
            
            <!-- æŠ€è¡“ä»•æ§˜ -->
            <div class="metadata-card">
                <h4>âš™ï¸ æŠ€è¡“ä»•æ§˜</h4>
                <div class="metadata-item">
                    <span class="metadata-label">æ¨å®šãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆ:</span>
                    <span class="metadata-value" id="bitrate">è¨ˆç®—ä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆ:</span>
                    <span class="metadata-value" id="sampleRate">æ¤œå‡ºä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">ãƒãƒ£ãƒ³ãƒãƒ«æ•°:</span>
                    <span class="metadata-value" id="channels">æ¤œå‡ºä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">éŸ³è³ªåˆ†é¡:</span>
                    <span class="metadata-value" id="quality">åˆ†æä¸­...</span>
                </div>
            </div>
            
            <!-- ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒãƒ¼ãƒˆ -->
            <div class="metadata-card">
                <h4>ğŸŒ ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒãƒ¼ãƒˆ</h4>
                <div class="metadata-item">
                    <span class="metadata-label">ç›´æ¥å†ç”Ÿ:</span>
                    <span class="metadata-value" id="directPlayback">ãƒ†ã‚¹ãƒˆä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—:</span>
                    <span class="metadata-value" id="metadataSupport">ãƒ†ã‚¹ãƒˆä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Web Audio API:</span>
                    <span class="metadata-value" id="webAudioSupport">ãƒã‚§ãƒƒã‚¯ä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">éŸ³é‡åˆ¶å¾¡:</span>
                    <span class="metadata-value" id="volumeSupport">ãƒ†ã‚¹ãƒˆä¸­...</span>
                </div>
            </div>
            
            <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ -->
            <div class="metadata-card">
                <h4>ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h4>
                <div class="metadata-item">
                    <span class="metadata-label">èª­ã¿è¾¼ã¿æ™‚é–“:</span>
                    <span class="metadata-value" id="loadTime">æ¸¬å®šä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">åˆå›å†ç”Ÿã¾ã§:</span>
                    <span class="metadata-value" id="timeToPlay">æ¸¬å®šä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·:</span>
                    <span class="metadata-value" id="latency">æ¸¬å®šä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">ç·åˆã‚¹ã‚³ã‚¢:</span>
                    <span class="metadata-value" id="overallScore">è¨ˆç®—ä¸­...</span>
                </div>
            </div>
        </div>
        
        <!-- å‘¨æ³¢æ•°ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ï¼ˆç–‘ä¼¼ï¼‰ -->
        <div class="frequency-analyzer">
            <h4>ğŸ“¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‘¨æ³¢æ•°ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼</h4>
            <div class="frequency-bars" id="frequencyBars">
                <!-- JavaScript ã§å‹•çš„ç”Ÿæˆ -->
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 0.8em;">
                <span>ä½éŸ³åŸŸ</span>
                <span>ä¸­éŸ³åŸŸ</span>
                <span>é«˜éŸ³åŸŸ</span>
            </div>
        </div>
        
        <!-- ã‚¤ã‚³ãƒ©ã‚¤ã‚¶ãƒ¼é¢¨ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ« -->
        <div class="equalizer" id="equalizer">
            <!-- JavaScript ã§å‹•çš„ç”Ÿæˆ -->
        </div>
        
        <!-- é«˜åº¦ãªãƒ†ã‚¹ãƒˆ -->
        <div class="advanced-tests">
            <h3>ğŸ”¬ é«˜åº¦ãªã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ†ã‚¹ãƒˆ</h3>
            <div class="test-grid">
                <div class="test-card">
                    <h4>ğŸ¯ éš ã—Audioãƒ†ã‚¹ãƒˆ</h4>
                    <p>éè¡¨ç¤ºaudioè¦ç´ ã§ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—</p>
                    <button id="testHiddenAudio">å®Ÿè¡Œ</button>
                </div>
                <div class="test-card">
                    <h4>ğŸ”„ è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹</h4>
                    <p>åŒæ™‚å†ç”Ÿãƒ»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç«¶åˆãƒ†ã‚¹ãƒˆ</p>
                    <button id="testMultipleAudio">å®Ÿè¡Œ</button>
                </div>
                <div class="test-card">
                    <h4>âš¡ Web Audio API</h4>
                    <p>é«˜åº¦ãªéŸ³å£°è§£æãƒ»å‡¦ç†ãƒ†ã‚¹ãƒˆ</p>
                    <button id="testWebAudio">å®Ÿè¡Œ</button>
                </div>
                <div class="test-card">
                    <h4>ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h4>
                    <p>èª­ã¿è¾¼ã¿ãƒ»å†ç”Ÿé€Ÿåº¦ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯</p>
                    <button id="testPerformance">å®Ÿè¡Œ</button>
                </div>
            </div>
            <div id="advancedResults" style="display: none;"></div>
        </div>
        
        <!-- ãƒ‡ãƒãƒƒã‚°æƒ…å ± -->
        <div class="metadata-card">
            <h4>ğŸ”§ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°</h4>
            <div class="code-block" id="debugLog">ãƒ†ã‚¹ãƒˆé–‹å§‹æ™‚åˆ»: <span id="startTime"></span></div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let testResults = {
            directPlayback: false,
            metadataExtracted: false,
            webAudioSupported: false,
            loadStartTime: Date.now(),
            firstPlayTime: null
        };
        
        let audioContext = null;
        let analyser = null;
        let dataArray = null;
        let animationId = null;
        
        // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°æ©Ÿèƒ½
        function addDebugLog(message) {
            const debugLog = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            debugLog.innerHTML += `\n[${timestamp}] ${message}`;
            debugLog.scrollTop = debugLog.scrollHeight;
        }
        
        // ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±ã®å–å¾—ã¨è¡¨ç¤º
        function detectBrowserInfo() {
            const userAgent = navigator.userAgent;
            const isWindows = userAgent.includes('Windows');
            const isChrome = userAgent.includes('Chrome') && !userAgent.includes('Edg');
            const isEdge = userAgent.includes('Edg');
            const isFirefox = userAgent.includes('Firefox');
            const isSafari = userAgent.includes('Safari') && !userAgent.includes('Chrome');
            
            let browserName = 'Unknown';
            if (isChrome) browserName = 'Google Chrome';
            else if (isEdge) browserName = 'Microsoft Edge';
            else if (isFirefox) browserName = 'Mozilla Firefox';
            else if (isSafari) browserName = 'Safari';
            
            const os = isWindows ? 'Windows' : (userAgent.includes('Mac') ? 'macOS' : 'ãã®ä»–');
            
            // ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚µãƒãƒ¼ãƒˆæ©Ÿèƒ½ã®æ¤œå‡º
            const audio = document.createElement('audio');
            const mp3Support = audio.canPlayType('audio/mpeg');
            const aacSupport = audio.canPlayType('audio/mp4; codecs="mp4a.40.2"');
            const webAudioSupport = typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined';
            
            document.getElementById('browserInfo').innerHTML = `
                <strong>OS:</strong> ${os}<br>
                <strong>ãƒ–ãƒ©ã‚¦ã‚¶:</strong> ${browserName}<br>
                <strong>MP3ã‚µãƒãƒ¼ãƒˆ:</strong> ${mp3Support || 'unknown'}<br>
                <strong>AACã‚µãƒãƒ¼ãƒˆ:</strong> ${aacSupport || 'unknown'}<br>
                <strong>Web Audio API:</strong> ${webAudioSupport ? 'âœ… ã‚µãƒãƒ¼ãƒˆ' : 'âŒ éã‚µãƒãƒ¼ãƒˆ'}
            `;
            
            testResults.webAudioSupported = webAudioSupport;
            document.getElementById('webAudioSupport').textContent = webAudioSupport ? 'âœ… ã‚µãƒãƒ¼ãƒˆ' : 'âŒ éã‚µãƒãƒ¼ãƒˆ';
            
            addDebugLog(`ãƒ–ãƒ©ã‚¦ã‚¶æ¤œå‡º: ${os} - ${browserName}`);
            addDebugLog(`ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚µãƒãƒ¼ãƒˆ: MP3=${mp3Support}, AAC=${aacSupport}, WebAudio=${webAudioSupport}`);
            
            return { isWindows, isChrome, isFirefox, isSafari, os, browserName };
        }
        
        // æ™‚é–“ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
        function formatTime(seconds) {
            if (isNaN(seconds) || !isFinite(seconds)) return '0:00';
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }
        
        // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºæ›´æ–°
        function updateMetadata(audio) {
            try {
                const duration = audio.duration;
                
                document.getElementById('duration').textContent = formatTime(duration);
                document.getElementById('totalTime').textContent = formatTime(duration);
                
                // ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆæ¨å®šï¼ˆ700KBã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’ä½¿ç”¨ï¼‰
                const fileSizeKB = 700;
                if (duration && duration > 0) {
                    const estimatedBitrate = Math.round((fileSizeKB * 8) / duration);
                    document.getElementById('bitrate').textContent = `${estimatedBitrate} kbps`;
                    
                    // éŸ³è³ªåˆ†é¡
                    let quality = 'unknown';
                    if (estimatedBitrate >= 320) quality = 'æœ€é«˜å“è³ª (320+ kbps)';
                    else if (estimatedBitrate >= 256) quality = 'é«˜å“è³ª (256 kbps)';
                    else if (estimatedBitrate >= 192) quality = 'æ¨™æº–å“è³ª (192 kbps)';
                    else if (estimatedBitrate >= 128) quality = 'æ™®é€šå“è³ª (128 kbps)';
                    else quality = 'ä½å“è³ª (128kbpsæœªæº€)';
                    
                    document.getElementById('quality').textContent = quality;
                } else {
                    document.getElementById('bitrate').textContent = 'è¨ˆç®—ä¸å¯';
                    document.getElementById('quality').textContent = 'ä¸æ˜';
                }
                
                testResults.metadataExtracted = true;
                document.getElementById('metadataSupport').textContent = 'âœ… æˆåŠŸ';
                
                addDebugLog(`ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ: ${formatTime(duration)}, ${Math.round((fileSizeKB * 8) / duration)}kbps`);
                updateOverallScore();
                
            } catch (error) {
                addDebugLog(`ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // å†ç”Ÿä½ç½®ã®æ›´æ–°
        function updateProgress(audio) {
            if (audio.duration > 0) {
                const progress = (audio.currentTime / audio.duration) * 100;
                document.getElementById('waveformProgress').style.width = progress + '%';
                document.getElementById('currentTime').textContent = formatTime(audio.currentTime);
            }
        }
        
        // ç·åˆã‚¹ã‚³ã‚¢ã®æ›´æ–°
        function updateOverallScore() {
            let score = 0;
            if (testResults.directPlayback) score += 30;
            if (testResults.metadataExtracted) score += 25;
            if (testResults.webAudioSupported) score += 25;
            if (testResults.firstPlayTime && testResults.firstPlayTime < 1000) score += 20;
            
            document.getElementById('overallScore').textContent = `${score}/100`;
            
            addDebugLog(`ç·åˆã‚¹ã‚³ã‚¢æ›´æ–°: ${score}/100`);
        }
        
        // Web Audio API ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        function setupWebAudio(audio) {
            if (!testResults.webAudioSupported) return;
            
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                const source = audioContext.createMediaElementSource(audio);
                
                source.connect(analyser);
                analyser.connect(audioContext.destination);
                
                analyser.fftSize = 256;
                const bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);
                
                // ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆæƒ…å ±
                document.getElementById('sampleRate').textContent = `${audioContext.sampleRate} Hz`;
                document.getElementById('channels').textContent = audioContext.destination.channelCount + ' ch';
                
                addDebugLog(`Web Audio API ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†: ${audioContext.sampleRate}Hz`);
                startVisualization();
                
            } catch (error) {
                addDebugLog(`Web Audio API ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('Web Audio API ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
        function startVisualization() {
            if (!analyser || !dataArray) return;
            
            function animate() {
                if (!analyser) return;
                
                analyser.getByteFrequencyData(dataArray);
                
                // å‘¨æ³¢æ•°ãƒãƒ¼ã®æ›´æ–°
                const frequencyBars = document.getElementById('frequencyBars');
                if (frequencyBars.children.length === 0) {
                    // åˆå›ä½œæˆ
                    for (let i = 0; i < 32; i++) {
                        const bar = document.createElement('div');
                        bar.className = 'freq-bar';
                        frequencyBars.appendChild(bar);
                    }
                }
                
                // ã‚¤ã‚³ãƒ©ã‚¤ã‚¶ãƒ¼ãƒãƒ¼ã®æ›´æ–°
                const equalizer = document.getElementById('equalizer');
                if (equalizer.children.length === 0) {
                    // åˆå›ä½œæˆ
                    for (let i = 0; i < 12; i++) {
                        const bar = document.createElement('div');
                        bar.className = 'eq-bar';
                        equalizer.appendChild(bar);
                    }
                }
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒ¼ã«åæ˜ 
                for (let i = 0; i < frequencyBars.children.length; i++) {
                    const value = dataArray[Math.floor(i * dataArray.length / 32)];
                    frequencyBars.children[i].style.height = `${(value / 255) * 100}px`;
                }
                
                for (let i = 0; i < equalizer.children.length; i++) {
                    const value = dataArray[Math.floor(i * dataArray.length / 12)];
                    equalizer.children[i].style.height = `${(value / 255) * 50}px`;
                }
                
                animationId = requestAnimationFrame(animate);
            }
            
            animate();
        }
        
        // éš ã—ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ†ã‚¹ãƒˆ
        function testHiddenAudio() {
            addDebugLog('éš ã—audioè¦ç´ ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            const hiddenAudio = document.createElement('audio');
            hiddenAudio.src = 'file_example_MP3_700KB.mp3';
            hiddenAudio.preload = 'metadata';
            hiddenAudio.style.display = 'none';
            document.body.appendChild(hiddenAudio);
            
            const startTime = Date.now();
            
            hiddenAudio.addEventListener('loadedmetadata', function() {
                const loadTime = Date.now() - startTime;
                addDebugLog(`éš ã—audioè¦ç´ : ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ (${loadTime}ms)`);
                setTimeout(() => hiddenAudio.remove(), 1000);
            });
            
            hiddenAudio.addEventListener('error', function(e) {
                addDebugLog(`éš ã—audioè¦ç´ : ã‚¨ãƒ©ãƒ¼ - ${e.message || 'Unknown error'}`);
                setTimeout(() => hiddenAudio.remove(), 1000);
            });
        }
        
        // è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        function testMultipleAudio() {
            addDebugLog('è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            for (let i = 0; i < 3; i++) {
                const audio = document.createElement('audio');
                audio.src = 'file_example_MP3_700KB.mp3';
                audio.preload = 'metadata';
                audio.style.display = 'none';
                document.body.appendChild(audio);
                
                audio.addEventListener('loadedmetadata', function() {
                    addDebugLog(`ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹${i + 1}: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ`);
                    setTimeout(() => audio.remove(), 2000);
                });
            }
        }
        
        // Web Audio API ãƒ†ã‚¹ãƒˆ
        function testWebAudioAPI() {
            if (!testResults.webAudioSupported) {
                addDebugLog('Web Audio API ãƒ†ã‚¹ãƒˆ: éã‚µãƒãƒ¼ãƒˆ');
                return;
            }
            
            addDebugLog('Web Audio API è©³ç´°ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                const testContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = testContext.createOscillator();
                const gainNode = testContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(testContext.destination);
                
                oscillator.frequency.setValueAtTime(440, testContext.currentTime);
                gainNode.gain.setValueAtTime(0.1, testContext.currentTime);
                
                oscillator.start(testContext.currentTime);
                oscillator.stop(testContext.currentTime + 0.1);
                
                addDebugLog('Web Audio API ãƒ†ã‚¹ãƒˆ: 440Hz ãƒ†ã‚¹ãƒˆãƒˆãƒ¼ãƒ³ç”ŸæˆæˆåŠŸ');
                
                setTimeout(() => testContext.close(), 200);
                
            } catch (error) {
                addDebugLog(`Web Audio API ãƒ†ã‚¹ãƒˆ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        function testPerformance() {
            addDebugLog('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            const iterations = 5;
            let totalTime = 0;
            
            for (let i = 0; i < iterations; i++) {
                const startTime = performance.now();
                
                const audio = document.createElement('audio');
                audio.src = 'file_example_MP3_700KB.mp3';
                audio.preload = 'metadata';
                
                audio.addEventListener('loadedmetadata', function() {
                    const loadTime = performance.now() - startTime;
                    totalTime += loadTime;
                    
                    if (i === iterations - 1) {
                        const averageTime = totalTime / iterations;
                        document.getElementById('latency').textContent = `${averageTime.toFixed(2)}ms`;
                        addDebugLog(`ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†: å¹³å‡ ${averageTime.toFixed(2)}ms`);
                    }
                    
                    audio.remove();
                });
            }
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // é–‹å§‹æ™‚åˆ»ã®è¡¨ç¤º
            document.getElementById('startTime').textContent = new Date().toLocaleString();
            
            // ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±ã®æ¤œå‡º
            const browserInfo = detectBrowserInfo();
            
            // MP3ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªè¦ç´ ã®è¨­å®š
            const audio = document.getElementById('mp3Audio');
            const statusDiv = document.getElementById('playbackStatus');
            
            // ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
            const playPauseBtn = document.getElementById('playPauseBtn');
            const stopBtn = document.getElementById('stopBtn');
            const rewindBtn = document.getElementById('rewindBtn');
            const forwardBtn = document.getElementById('forwardBtn');
            const volumeSlider = document.getElementById('volumeSlider');
            const volumeDisplay = document.getElementById('volumeDisplay');
            
            // èª­ã¿è¾¼ã¿é–‹å§‹
            audio.addEventListener('loadstart', function() {
                addDebugLog('ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªèª­ã¿è¾¼ã¿é–‹å§‹');
                testResults.loadStartTime = Date.now();
            });
            
            // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ
            audio.addEventListener('loadedmetadata', function() {
                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… æˆåŠŸ: MP3ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ';
                updateMetadata(audio);
                
                const loadTime = Date.now() - testResults.loadStartTime;
                document.getElementById('loadTime').textContent = `${loadTime}ms`;
                addDebugLog('ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ');
                
                setupWebAudio(audio);
            });
            
            // å†ç”Ÿå¯èƒ½çŠ¶æ…‹
            audio.addEventListener('canplay', function() {
                testResults.directPlayback = true;
                document.getElementById('directPlayback').textContent = 'âœ… ã‚µãƒãƒ¼ãƒˆ';
                addDebugLog('å†ç”Ÿå¯èƒ½çŠ¶æ…‹ã«åˆ°é”');
                updateOverallScore();
            });
            
            // å†ç”Ÿé–‹å§‹
            audio.addEventListener('play', function() {
                if (!testResults.firstPlayTime) {
                    testResults.firstPlayTime = Date.now() - testResults.loadStartTime;
                    document.getElementById('timeToPlay').textContent = `${testResults.firstPlayTime}ms`;
                }
                statusDiv.className = 'status success';
                statusDiv.textContent = 'â–¶ï¸ å†ç”Ÿä¸­: MP3ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«å†ç”Ÿã•ã‚Œã¦ã„ã¾ã™';
                playPauseBtn.textContent = 'â¸ï¸ ä¸€æ™‚åœæ­¢';
                addDebugLog('å†ç”Ÿé–‹å§‹');
                
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            });
            
            // ä¸€æ™‚åœæ­¢
            audio.addEventListener('pause', function() {
                playPauseBtn.textContent = 'â–¶ï¸ å†ç”Ÿ';
                addDebugLog('ä¸€æ™‚åœæ­¢');
            });
            
            // é€²è¡ŒçŠ¶æ³æ›´æ–°
            audio.addEventListener('timeupdate', function() {
                updateProgress(audio);
            });
            
            // éŸ³é‡åˆ¶å¾¡ãƒ†ã‚¹ãƒˆ
            volumeSlider.addEventListener('input', function() {
                audio.volume = this.value;
                volumeDisplay.textContent = Math.round(this.value * 100) + '%';
                document.getElementById('volumeSupport').textContent = 'âœ… å¯¾å¿œ';
            });
            
            // ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
            playPauseBtn.addEventListener('click', function() {
                if (audio.paused) {
                    audio.play();
                } else {
                    audio.pause();
                }
            });
            
            stopBtn.addEventListener('click', function() {
                audio.pause();
                audio.currentTime = 0;
                playPauseBtn.textContent = 'â–¶ï¸ å†ç”Ÿ';
            });
            
            rewindBtn.addEventListener('click', function() {
                audio.currentTime = Math.max(0, audio.currentTime - 10);
            });
            
            forwardBtn.addEventListener('click', function() {
                audio.currentTime = Math.min(audio.duration, audio.currentTime + 10);
            });
            
            // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
            audio.addEventListener('error', function(e) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼: MP3ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ';
                addDebugLog(`å†ç”Ÿã‚¨ãƒ©ãƒ¼: ${e.message || 'Unknown error'}`);
            });
            
            // é«˜åº¦ãªãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³
            document.getElementById('testHiddenAudio').addEventListener('click', testHiddenAudio);
            document.getElementById('testMultipleAudio').addEventListener('click', testMultipleAudio);
            document.getElementById('testWebAudio').addEventListener('click', testWebAudioAPI);
            document.getElementById('testPerformance').addEventListener('click', testPerformance);
            
            addDebugLog('åˆæœŸåŒ–å®Œäº† - MP3ãƒ†ã‚¹ãƒˆé–‹å§‹');
        });
        
        // ãƒšãƒ¼ã‚¸ã‚’é›¢ã‚Œã‚‹æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        window.addEventListener('beforeunload', function() {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            if (audioContext) {
                audioContext.close();
            }
        });
    </script>
</body>
</html>
