<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MP3„Éï„Ç°„Ç§„É´ÂÜçÁîü„ÉÜ„Çπ„Éà - „Ç™„Éº„Éá„Ç£„Ç™„É°„Çø„Éá„Éº„ÇøË©≥Á¥∞ÂàÜÊûê</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5rem;
        }
        
        .browser-info {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .audio-section {
            margin: 30px 0;
            padding: 25px;
            border: 2px solid #ddd;
            border-radius: 12px;
            background: linear-gradient(to bottom, #fafafa, #f0f8ff);
        }
        
        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .audio-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .control-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            min-width: 80px;
        }
        
        .control-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .volume-slider {
            width: 100px;
            cursor: pointer;
        }
        
        .metadata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .metadata-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .metadata-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .metadata-card h4 {
            margin-top: 0;
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .metadata-item {
            margin: 12px 0;
            padding: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px dotted #ccc;
        }
        
        .metadata-label {
            font-weight: bold;
            color: #555;
        }
        
        .metadata-value {
            color: #333;
            background: #f8f9fa;
            padding: 6px 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .waveform-container {
            margin: 20px 0;
            padding: 20px;
            background: #1a1a2e;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .waveform {
            width: 100%;
            height: 80px;
            background: repeating-linear-gradient(
                90deg,
                #4ecdc4 0px,
                #4ecdc4 2px,
                transparent 2px,
                transparent 6px
            );
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        
        .waveform-progress {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #feca57);
            width: 0%;
            transition: width 0.1s ease;
            border-radius: 4px 0 0 4px;
        }
        
        .time-display {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-family: monospace;
            font-size: 1.1em;
            color: #555;
        }
        
        .status {
            padding: 12px;
            margin: 12px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b3d7ff;
        }
        
        .frequency-analyzer {
            margin: 20px 0;
            padding: 20px;
            background: #16213e;
            border-radius: 10px;
            color: white;
        }
        
        .frequency-bars {
            display: flex;
            justify-content: space-between;
            align-items: end;
            height: 100px;
            gap: 2px;
            margin: 15px 0;
        }
        
        .freq-bar {
            background: linear-gradient(to top, #ff6b6b, #4ecdc4);
            width: 8px;
            min-height: 2px;
            border-radius: 4px 4px 0 0;
            transition: height 0.1s ease;
        }
        
        .advanced-tests {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 10px;
            color: white;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .test-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #4a5568;
        }
        
        .audio-format-badge {
            display: inline-block;
            background: #ff6b6b;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 11px;
            margin: 2px;
            font-weight: bold;
        }
        
        .equalizer {
            display: flex;
            justify-content: center;
            align-items: end;
            height: 60px;
            gap: 3px;
            margin: 15px 0;
            padding: 10px;
            background: #1a1a2e;
            border-radius: 8px;
        }
        
        .eq-bar {
            width: 12px;
            background: linear-gradient(to top, #4ecdc4, #44a08d);
            border-radius: 6px;
            transition: height 0.2s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéµ MP3„Éï„Ç°„Ç§„É´Ë©≥Á¥∞ÂàÜÊûê„ÉÜ„Çπ„Éà</h1>
        <p style="text-align: center; color: #666; font-size: 1.1em;">
            È´òÂìÅË≥™„Ç™„Éº„Éá„Ç£„Ç™„Éï„Ç°„Ç§„É´„ÅÆÂåÖÊã¨ÁöÑ„É°„Çø„Éá„Éº„ÇøÂèñÂæó & ÂÜçÁîüÂàÜÊûê
        </p>
        
        <!-- „Éñ„É©„Ç¶„Ç∂ÊÉÖÂ†± -->
        <div class="browser-info">
            <h3>üñ•Ô∏è „Éñ„É©„Ç¶„Ç∂„Éª„Ç™„Éº„Éá„Ç£„Ç™„Çµ„Éù„Éº„ÉàÊÉÖÂ†±</h3>
            <div id="browserInfo">Ê§úÂá∫‰∏≠...</div>
            <div style="margin-top: 10px;">
                <div class="audio-format-badge">MP3ÂØæÂøú</div>
                <div class="audio-format-badge">AACÂØæÂøú</div>
                <div class="audio-format-badge">Web Audio API</div>
            </div>
        </div>
        
        <!-- MP3„Éï„Ç°„Ç§„É´ÂÜçÁîü„ÉÜ„Çπ„Éà -->
        <div class="audio-section">
            <h3>üé∂ MP3„Éï„Ç°„Ç§„É´ÂÜçÁîü & „É°„Çø„Éá„Éº„Çø„ÉÜ„Çπ„Éà</h3>
            <p><strong>„ÉÜ„Çπ„ÉàÁî®MP3„Éï„Ç°„Ç§„É´:</strong> file_example_MP3_700KB.mp3</p>
            
            <audio id="mp3Audio" class="audio-player" controls preload="metadata">
                <source src="file_example_MP3_700KB.mp3" type="audio/mpeg">
                „Åä‰Ωø„ÅÑ„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØMP3„Éï„Ç°„Ç§„É´„Çí„Çµ„Éù„Éº„Éà„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
            </audio>
            
            <!-- „Ç´„Çπ„Çø„É†„Ç™„Éº„Éá„Ç£„Ç™„Ç≥„É≥„Éà„É≠„Éº„É´ -->
            <div class="audio-controls">
                <button class="control-btn" id="playPauseBtn">‚ñ∂Ô∏è ÂÜçÁîü</button>
                <button class="control-btn" id="stopBtn">‚èπÔ∏è ÂÅúÊ≠¢</button>
                <button class="control-btn" id="rewindBtn">‚è™ Â∑ªÊàª„Åó</button>
                <button class="control-btn" id="forwardBtn">‚è© Êó©ÈÄÅ„Çä</button>
                <div class="volume-control">
                    <span>üîä</span>
                    <input type="range" id="volumeSlider" class="volume-slider" min="0" max="1" step="0.1" value="1">
                    <span id="volumeDisplay">100%</span>
                </div>
            </div>
            
            <!-- Ê≥¢ÂΩ¢„Éì„Ç∏„É•„Ç¢„É©„Ç§„Ç∂„ÉºÔºàÁñë‰ººÔºâ -->
            <div class="waveform-container">
                <h4 style="color: white; margin-top: 0;">üåä „Ç™„Éº„Éá„Ç£„Ç™Ê≥¢ÂΩ¢„Éì„Ç∏„É•„Ç¢„É©„Ç§„Ç∂„Éº</h4>
                <div class="waveform">
                    <div class="waveform-progress" id="waveformProgress"></div>
                </div>
                <div class="time-display">
                    <span id="currentTime">0:00</span>
                    <span id="totalTime">0:00</span>
                </div>
            </div>
            
            <div id="playbackStatus" class="status info">
                „Çπ„ÉÜ„Éº„Çø„Çπ: Ë™≠„ÅøËæº„Åø‰∏≠...
            </div>
        </div>
        
        <!-- „É°„Çø„Éá„Éº„ÇøË©≥Á¥∞Ë°®Á§∫ -->
        <div class="metadata-grid">
            <!-- Âü∫Êú¨„Ç™„Éº„Éá„Ç£„Ç™ÊÉÖÂ†± -->
            <div class="metadata-card">
                <h4>üéµ Âü∫Êú¨„Ç™„Éº„Éá„Ç£„Ç™ÊÉÖÂ†±</h4>
                <div class="metadata-item">
                    <span class="metadata-label">ÂÜçÁîüÊôÇÈñì:</span>
                    <span class="metadata-value" id="duration">ÂèñÂæó‰∏≠...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">„Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫:</span>
                    <span class="metadata-value">700 KB</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">ÂΩ¢Âºè:</span>
                    <span class="metadata-value">MP3 (MPEG Audio Layer 3)</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">MIME„Çø„Ç§„Éó:</span>
                    <span class="metadata-value" id="mimeType">audio/mpeg</span>
                </div>
            </div>
            
            <!-- ÊäÄË°ì‰ªïÊßò -->
            <div class="metadata-card">
                <h4>‚öôÔ∏è ÊäÄË°ì‰ªïÊßò</h4>
                <div class="metadata-item">
                    <span class="metadata-label">Êé®ÂÆö„Éì„ÉÉ„Éà„É¨„Éº„Éà:</span>
                    <span class="metadata-value" id="bitrate">Ë®àÁÆó‰∏≠...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">„Çµ„É≥„Éó„É™„É≥„Ç∞„É¨„Éº„Éà:</span>
                    <span class="metadata-value" id="sampleRate">Ê§úÂá∫‰∏≠...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">„ÉÅ„É£„É≥„Éç„É´Êï∞:</span>
                    <span class="metadata-value" id="channels">Ê§úÂá∫‰∏≠...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Èü≥Ë≥™ÂàÜÈ°û:</span>
                    <span class="metadata-value" id="quality">ÂàÜÊûê‰∏≠...</span>
                </div>
            </div>
            
            <!-- „Éñ„É©„Ç¶„Ç∂„Çµ„Éù„Éº„Éà -->
            <div class="metadata-card">
                <h4>üåê „Éñ„É©„Ç¶„Ç∂„Çµ„Éù„Éº„Éà</h4>
                <div class="metadata-item">
                    <span class="metadata-label">Áõ¥Êé•ÂÜçÁîü:</span>
                    <span class="metadata-value" id="directPlayback">„ÉÜ„Çπ„Éà‰∏≠...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">„É°„Çø„Éá„Éº„ÇøÂèñÂæó:</span>
                    <span class="metadata-value" id="metadataSupport">„ÉÜ„Çπ„Éà‰∏≠...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Web Audio API:</span>
                    <span class="metadata-value" id="webAudioSupport">„ÉÅ„Çß„ÉÉ„ÇØ‰∏≠...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Èü≥ÈáèÂà∂Âæ°:</span>
                    <span class="metadata-value" id="volumeSupport">„ÉÜ„Çπ„Éà‰∏≠...</span>
                </div>
            </div>
            
            <!-- „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ -->
            <div class="metadata-card">
                <h4>üìä „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ</h4>
                <div class="metadata-item">
                    <span class="metadata-label">Ë™≠„ÅøËæº„ÅøÊôÇÈñì:</span>
                    <span class="metadata-value" id="loadTime">Ê∏¨ÂÆö‰∏≠...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">ÂàùÂõûÂÜçÁîü„Åæ„Åß:</span>
                    <span class="metadata-value" id="timeToPlay">Ê∏¨ÂÆö‰∏≠...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">„É¨„Ç§„ÉÜ„É≥„Ç∑:</span>
                    <span class="metadata-value" id="latency">Ê∏¨ÂÆö‰∏≠...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Á∑èÂêà„Çπ„Ç≥„Ç¢:</span>
                    <span class="metadata-value" id="overallScore">Ë®àÁÆó‰∏≠...</span>
                </div>
            </div>
        </div>
        
        <!-- Âë®Ê≥¢Êï∞„Ç¢„Éä„É©„Ç§„Ç∂„ÉºÔºàÁñë‰ººÔºâ -->
        <div class="frequency-analyzer">
            <h4>üì° „É™„Ç¢„É´„Çø„Ç§„É†Âë®Ê≥¢Êï∞„Ç¢„Éä„É©„Ç§„Ç∂„Éº</h4>
            <div class="frequency-bars" id="frequencyBars">
                <!-- JavaScript „ÅßÂãïÁöÑÁîüÊàê -->
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 0.8em;">
                <span>‰ΩéÈü≥Âüü</span>
                <span>‰∏≠Èü≥Âüü</span>
                <span>È´òÈü≥Âüü</span>
            </div>
        </div>
        
        <!-- „Ç§„Ç≥„É©„Ç§„Ç∂„ÉºÈ¢®„Éì„Ç∏„É•„Ç¢„É´ -->
        <div class="equalizer" id="equalizer">
            <!-- JavaScript „ÅßÂãïÁöÑÁîüÊàê -->
        </div>
        
        <!-- È´òÂ∫¶„Å™„ÉÜ„Çπ„Éà -->
        <div class="advanced-tests">
            <h3>üî¨ È´òÂ∫¶„Å™„Ç™„Éº„Éá„Ç£„Ç™„ÉÜ„Çπ„Éà</h3>
            <div class="test-grid">
                <div class="test-card">
                    <h4>üéØ Èö†„ÅóAudio„ÉÜ„Çπ„Éà</h4>
                    <p>ÈùûË°®Á§∫audioË¶ÅÁ¥†„Åß„ÅÆ„É°„Çø„Éá„Éº„ÇøÂèñÂæó</p>
                    <button id="testHiddenAudio">ÂÆüË°å</button>
                </div>
                <div class="test-card">
                    <h4>üîÑ Ë§áÊï∞„Ç§„É≥„Çπ„Çø„É≥„Çπ</h4>
                    <p>ÂêåÊôÇÂÜçÁîü„Éª„É°„Çø„Éá„Éº„ÇøÁ´∂Âêà„ÉÜ„Çπ„Éà</p>
                    <button id="testMultipleAudio">ÂÆüË°å</button>
                </div>
                <div class="test-card">
                    <h4>‚ö° Web Audio API</h4>
                    <p>È´òÂ∫¶„Å™Èü≥Â£∞Ëß£Êûê„ÉªÂá¶ÁêÜ„ÉÜ„Çπ„Éà</p>
                    <button id="testWebAudio">ÂÆüË°å</button>
                </div>
                <div class="test-card">
                    <h4>üìà „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ</h4>
                    <p>Ë™≠„ÅøËæº„Åø„ÉªÂÜçÁîüÈÄüÂ∫¶„Éô„É≥„ÉÅ„Éû„Éº„ÇØ</p>
                    <button id="testPerformance">ÂÆüË°å</button>
                </div>
            </div>
            <div id="advancedResults" style="display: none;"></div>
        </div>
        
        <!-- „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†± -->
        <div class="metadata-card">
            <h4>üîß „É™„Ç¢„É´„Çø„Ç§„É†„Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞</h4>
            <div class="code-block" id="debugLog">„ÉÜ„Çπ„ÉàÈñãÂßãÊôÇÂàª: <span id="startTime"></span></div>
        </div>
    </div>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let testResults = {
            directPlayback: false,
            metadataExtracted: false,
            webAudioSupported: false,
            loadStartTime: Date.now(),
            firstPlayTime: null
        };
        
        let audioContext = null;
        let analyser = null;
        let dataArray = null;
        let animationId = null;
        
        // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞Ê©üËÉΩ
        function addDebugLog(message) {
            const debugLog = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            debugLog.innerHTML += `\n[${timestamp}] ${message}`;
            debugLog.scrollTop = debugLog.scrollHeight;
        }
        
        // „Éñ„É©„Ç¶„Ç∂ÊÉÖÂ†±„ÅÆÂèñÂæó„Å®Ë°®Á§∫
        function detectBrowserInfo() {
            const userAgent = navigator.userAgent;
            const isWindows = userAgent.includes('Windows');
            const isChrome = userAgent.includes('Chrome') && !userAgent.includes('Edg');
            const isEdge = userAgent.includes('Edg');
            const isFirefox = userAgent.includes('Firefox');
            const isSafari = userAgent.includes('Safari') && !userAgent.includes('Chrome');
            
            let browserName = 'Unknown';
            if (isChrome) browserName = 'Google Chrome';
            else if (isEdge) browserName = 'Microsoft Edge';
            else if (isFirefox) browserName = 'Mozilla Firefox';
            else if (isSafari) browserName = 'Safari';
            
            const os = isWindows ? 'Windows' : (userAgent.includes('Mac') ? 'macOS' : '„Åù„ÅÆ‰ªñ');
            
            // „Ç™„Éº„Éá„Ç£„Ç™„Çµ„Éù„Éº„ÉàÊ©üËÉΩ„ÅÆÊ§úÂá∫
            const audio = document.createElement('audio');
            const mp3Support = audio.canPlayType('audio/mpeg');
            const aacSupport = audio.canPlayType('audio/mp4; codecs="mp4a.40.2"');
            const webAudioSupport = typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined';
            
            document.getElementById('browserInfo').innerHTML = `
                <strong>OS:</strong> ${os}<br>
                <strong>„Éñ„É©„Ç¶„Ç∂:</strong> ${browserName}<br>
                <strong>MP3„Çµ„Éù„Éº„Éà:</strong> ${mp3Support || 'unknown'}<br>
                <strong>AAC„Çµ„Éù„Éº„Éà:</strong> ${aacSupport || 'unknown'}<br>
                <strong>Web Audio API:</strong> ${webAudioSupport ? '‚úÖ „Çµ„Éù„Éº„Éà' : '‚ùå Èùû„Çµ„Éù„Éº„Éà'}
            `;
            
            testResults.webAudioSupported = webAudioSupport;
            document.getElementById('webAudioSupport').textContent = webAudioSupport ? '‚úÖ „Çµ„Éù„Éº„Éà' : '‚ùå Èùû„Çµ„Éù„Éº„Éà';
            
            addDebugLog(`„Éñ„É©„Ç¶„Ç∂Ê§úÂá∫: ${os} - ${browserName}`);
            addDebugLog(`„Ç™„Éº„Éá„Ç£„Ç™„Çµ„Éù„Éº„Éà: MP3=${mp3Support}, AAC=${aacSupport}, WebAudio=${webAudioSupport}`);
            
            return { isWindows, isChrome, isFirefox, isSafari, os, browserName };
        }
        
        // ÊôÇÈñì„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÈñ¢Êï∞
        function formatTime(seconds) {
            if (isNaN(seconds) || !isFinite(seconds)) return '0:00';
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }
        
        // „É°„Çø„Éá„Éº„ÇøË°®Á§∫Êõ¥Êñ∞
        function updateMetadata(audio) {
            try {
                const duration = audio.duration;
                
                document.getElementById('duration').textContent = formatTime(duration);
                document.getElementById('totalTime').textContent = formatTime(duration);
                
                // „Éì„ÉÉ„Éà„É¨„Éº„ÉàÊé®ÂÆöÔºà700KB„ÅÆ„Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫„Çí‰ΩøÁî®Ôºâ
                const fileSizeKB = 700;
                if (duration && duration > 0) {
                    const estimatedBitrate = Math.round((fileSizeKB * 8) / duration);
                    document.getElementById('bitrate').textContent = `${estimatedBitrate} kbps`;
                    
                    // Èü≥Ë≥™ÂàÜÈ°û
                    let quality = 'unknown';
                    if (estimatedBitrate >= 320) quality = 'ÊúÄÈ´òÂìÅË≥™ (320+ kbps)';
                    else if (estimatedBitrate >= 256) quality = 'È´òÂìÅË≥™ (256 kbps)';
                    else if (estimatedBitrate >= 192) quality = 'Ê®ôÊ∫ñÂìÅË≥™ (192 kbps)';
                    else if (estimatedBitrate >= 128) quality = 'ÊôÆÈÄöÂìÅË≥™ (128 kbps)';
                    else quality = '‰ΩéÂìÅË≥™ (128kbpsÊú™Ê∫Ä)';
                    
                    document.getElementById('quality').textContent = quality;
                } else {
                    document.getElementById('bitrate').textContent = 'Ë®àÁÆó‰∏çÂèØ';
                    document.getElementById('quality').textContent = '‰∏çÊòé';
                }
                
                testResults.metadataExtracted = true;
                document.getElementById('metadataSupport').textContent = '‚úÖ ÊàêÂäü';
                
                addDebugLog(`„É°„Çø„Éá„Éº„ÇøÂèñÂæóÊàêÂäü: ${formatTime(duration)}, ${Math.round((fileSizeKB * 8) / duration)}kbps`);
                updateOverallScore();
                
            } catch (error) {
                addDebugLog(`„É°„Çø„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº: ${error.message}`);
                console.error('„É°„Çø„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº:', error);
            }
        }
        
        // ÂÜçÁîü‰ΩçÁΩÆ„ÅÆÊõ¥Êñ∞
        function updateProgress(audio) {
            if (audio.duration > 0) {
                const progress = (audio.currentTime / audio.duration) * 100;
                document.getElementById('waveformProgress').style.width = progress + '%';
                document.getElementById('currentTime').textContent = formatTime(audio.currentTime);
            }
        }
        
        // Á∑èÂêà„Çπ„Ç≥„Ç¢„ÅÆÊõ¥Êñ∞
        function updateOverallScore() {
            let score = 0;
            if (testResults.directPlayback) score += 30;
            if (testResults.metadataExtracted) score += 25;
            if (testResults.webAudioSupported) score += 25;
            if (testResults.firstPlayTime && testResults.firstPlayTime < 1000) score += 20;
            
            document.getElementById('overallScore').textContent = `${score}/100`;
            
            addDebugLog(`Á∑èÂêà„Çπ„Ç≥„Ç¢Êõ¥Êñ∞: ${score}/100`);
        }
        
        // Web Audio API „Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
        function setupWebAudio(audio) {
            if (!testResults.webAudioSupported) return;
            
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                const source = audioContext.createMediaElementSource(audio);
                
                source.connect(analyser);
                analyser.connect(audioContext.destination);
                
                analyser.fftSize = 256;
                const bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);
                
                // „Çµ„É≥„Éó„É™„É≥„Ç∞„É¨„Éº„ÉàÊÉÖÂ†±
                document.getElementById('sampleRate').textContent = `${audioContext.sampleRate} Hz`;
                document.getElementById('channels').textContent = audioContext.destination.channelCount + ' ch';
                
                addDebugLog(`Web Audio API „Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÂÆå‰∫Ü: ${audioContext.sampleRate}Hz`);
                startVisualization();
                
            } catch (error) {
                addDebugLog(`Web Audio API „Ç®„É©„Éº: ${error.message}`);
                console.error('Web Audio API „Ç®„É©„Éº:', error);
            }
        }
        
        // „Éì„Ç∏„É•„Ç¢„É©„Ç§„Çº„Éº„Ç∑„Éß„É≥ÈñãÂßã
        function startVisualization() {
            if (!analyser || !dataArray) return;
            
            function animate() {
                if (!analyser) return;
                
                analyser.getByteFrequencyData(dataArray);
                
                // Âë®Ê≥¢Êï∞„Éê„Éº„ÅÆÊõ¥Êñ∞
                const frequencyBars = document.getElementById('frequencyBars');
                if (frequencyBars.children.length === 0) {
                    // ÂàùÂõû‰ΩúÊàê
                    for (let i = 0; i < 32; i++) {
                        const bar = document.createElement('div');
                        bar.className = 'freq-bar';
                        frequencyBars.appendChild(bar);
                    }
                }
                
                // „Ç§„Ç≥„É©„Ç§„Ç∂„Éº„Éê„Éº„ÅÆÊõ¥Êñ∞
                const equalizer = document.getElementById('equalizer');
                if (equalizer.children.length === 0) {
                    // ÂàùÂõû‰ΩúÊàê
                    for (let i = 0; i < 12; i++) {
                        const bar = document.createElement('div');
                        bar.className = 'eq-bar';
                        equalizer.appendChild(bar);
                    }
                }
                
                // „Éá„Éº„Çø„Çí„Éê„Éº„Å´ÂèçÊò†
                for (let i = 0; i < frequencyBars.children.length; i++) {
                    const value = dataArray[Math.floor(i * dataArray.length / 32)];
                    frequencyBars.children[i].style.height = `${(value / 255) * 100}px`;
                }
                
                for (let i = 0; i < equalizer.children.length; i++) {
                    const value = dataArray[Math.floor(i * dataArray.length / 12)];
                    equalizer.children[i].style.height = `${(value / 255) * 50}px`;
                }
                
                animationId = requestAnimationFrame(animate);
            }
            
            animate();
        }
        
        // Èö†„Åó„Ç™„Éº„Éá„Ç£„Ç™„ÉÜ„Çπ„Éà
        function testHiddenAudio() {
            addDebugLog('Èö†„ÅóaudioË¶ÅÁ¥†„ÉÜ„Çπ„ÉàÈñãÂßã');
            
            const hiddenAudio = document.createElement('audio');
            hiddenAudio.src = 'file_example_MP3_700KB.mp3';
            hiddenAudio.preload = 'metadata';
            hiddenAudio.style.display = 'none';
            document.body.appendChild(hiddenAudio);
            
            const startTime = Date.now();
            
            hiddenAudio.addEventListener('loadedmetadata', function() {
                const loadTime = Date.now() - startTime;
                addDebugLog(`Èö†„ÅóaudioË¶ÅÁ¥†: „É°„Çø„Éá„Éº„ÇøÂèñÂæóÊàêÂäü (${loadTime}ms)`);
                setTimeout(() => hiddenAudio.remove(), 1000);
            });
            
            hiddenAudio.addEventListener('error', function(e) {
                addDebugLog(`Èö†„ÅóaudioË¶ÅÁ¥†: „Ç®„É©„Éº - ${e.message || 'Unknown error'}`);
                setTimeout(() => hiddenAudio.remove(), 1000);
            });
        }
        
        // Ë§áÊï∞„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÉÜ„Çπ„Éà
        function testMultipleAudio() {
            addDebugLog('Ë§áÊï∞„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÉÜ„Çπ„ÉàÈñãÂßã');
            
            for (let i = 0; i < 3; i++) {
                const audio = document.createElement('audio');
                audio.src = 'file_example_MP3_700KB.mp3';
                audio.preload = 'metadata';
                audio.style.display = 'none';
                document.body.appendChild(audio);
                
                audio.addEventListener('loadedmetadata', function() {
                    addDebugLog(`„Ç§„É≥„Çπ„Çø„É≥„Çπ${i + 1}: „É°„Çø„Éá„Éº„ÇøÂèñÂæóÊàêÂäü`);
                    setTimeout(() => audio.remove(), 2000);
                });
            }
        }
        
        // Web Audio API „ÉÜ„Çπ„Éà
        function testWebAudioAPI() {
            if (!testResults.webAudioSupported) {
                addDebugLog('Web Audio API „ÉÜ„Çπ„Éà: Èùû„Çµ„Éù„Éº„Éà');
                return;
            }
            
            addDebugLog('Web Audio API Ë©≥Á¥∞„ÉÜ„Çπ„ÉàÈñãÂßã');
            
            try {
                const testContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = testContext.createOscillator();
                const gainNode = testContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(testContext.destination);
                
                oscillator.frequency.setValueAtTime(440, testContext.currentTime);
                gainNode.gain.setValueAtTime(0.1, testContext.currentTime);
                
                oscillator.start(testContext.currentTime);
                oscillator.stop(testContext.currentTime + 0.1);
                
                addDebugLog('Web Audio API „ÉÜ„Çπ„Éà: 440Hz „ÉÜ„Çπ„Éà„Éà„Éº„É≥ÁîüÊàêÊàêÂäü');
                
                setTimeout(() => testContext.close(), 200);
                
            } catch (error) {
                addDebugLog(`Web Audio API „ÉÜ„Çπ„Éà „Ç®„É©„Éº: ${error.message}`);
            }
        }
        
        // „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà
        function testPerformance() {
            addDebugLog('„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„ÉàÈñãÂßã');
            
            const iterations = 5;
            let totalTime = 0;
            
            for (let i = 0; i < iterations; i++) {
                const startTime = performance.now();
                
                const audio = document.createElement('audio');
                audio.src = 'file_example_MP3_700KB.mp3';
                audio.preload = 'metadata';
                
                audio.addEventListener('loadedmetadata', function() {
                    const loadTime = performance.now() - startTime;
                    totalTime += loadTime;
                    
                    if (i === iterations - 1) {
                        const averageTime = totalTime / iterations;
                        document.getElementById('latency').textContent = `${averageTime.toFixed(2)}ms`;
                        addDebugLog(`„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„ÉàÂÆå‰∫Ü: Âπ≥Âùá ${averageTime.toFixed(2)}ms`);
                    }
                    
                    audio.remove();
                });
            }
        }
        
        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ÈñãÂßãÊôÇÂàª„ÅÆË°®Á§∫
            document.getElementById('startTime').textContent = new Date().toLocaleString();
            
            // „Éñ„É©„Ç¶„Ç∂ÊÉÖÂ†±„ÅÆÊ§úÂá∫
            const browserInfo = detectBrowserInfo();
            
            // MP3„Ç™„Éº„Éá„Ç£„Ç™Ë¶ÅÁ¥†„ÅÆË®≠ÂÆö
            const audio = document.getElementById('mp3Audio');
            const statusDiv = document.getElementById('playbackStatus');
            
            // „Ç´„Çπ„Çø„É†„Ç≥„É≥„Éà„É≠„Éº„É´„ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
            const playPauseBtn = document.getElementById('playPauseBtn');
            const stopBtn = document.getElementById('stopBtn');
            const rewindBtn = document.getElementById('rewindBtn');
            const forwardBtn = document.getElementById('forwardBtn');
            const volumeSlider = document.getElementById('volumeSlider');
            const volumeDisplay = document.getElementById('volumeDisplay');
            
            // Ë™≠„ÅøËæº„ÅøÈñãÂßã
            audio.addEventListener('loadstart', function() {
                addDebugLog('„Ç™„Éº„Éá„Ç£„Ç™Ë™≠„ÅøËæº„ÅøÈñãÂßã');
                testResults.loadStartTime = Date.now();
            });
            
            // „É°„Çø„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÊàêÂäü
            audio.addEventListener('loadedmetadata', function() {
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ ÊàêÂäü: MP3„É°„Çø„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü';
                updateMetadata(audio);
                
                const loadTime = Date.now() - testResults.loadStartTime;
                document.getElementById('loadTime').textContent = `${loadTime}ms`;
                addDebugLog('„É°„Çø„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÊàêÂäü');
                
                setupWebAudio(audio);
            });
            
            // ÂÜçÁîüÂèØËÉΩÁä∂ÊÖã
            audio.addEventListener('canplay', function() {
                testResults.directPlayback = true;
                document.getElementById('directPlayback').textContent = '‚úÖ „Çµ„Éù„Éº„Éà';
                addDebugLog('ÂÜçÁîüÂèØËÉΩÁä∂ÊÖã„Å´Âà∞ÈÅî');
                updateOverallScore();
            });
            
            // ÂÜçÁîüÈñãÂßã
            audio.addEventListener('play', function() {
                if (!testResults.firstPlayTime) {
                    testResults.firstPlayTime = Date.now() - testResults.loadStartTime;
                    document.getElementById('timeToPlay').textContent = `${testResults.firstPlayTime}ms`;
                }
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚ñ∂Ô∏è ÂÜçÁîü‰∏≠: MP3„Éï„Ç°„Ç§„É´„ÅåÊ≠£Â∏∏„Å´ÂÜçÁîü„Åï„Çå„Å¶„ÅÑ„Åæ„Åô';
                playPauseBtn.textContent = '‚è∏Ô∏è ‰∏ÄÊôÇÂÅúÊ≠¢';
                addDebugLog('ÂÜçÁîüÈñãÂßã');
                
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            });
            
            // ‰∏ÄÊôÇÂÅúÊ≠¢
            audio.addEventListener('pause', function() {
                playPauseBtn.textContent = '‚ñ∂Ô∏è ÂÜçÁîü';
                addDebugLog('‰∏ÄÊôÇÂÅúÊ≠¢');
            });
            
            // ÈÄ≤Ë°åÁä∂Ê≥ÅÊõ¥Êñ∞
            audio.addEventListener('timeupdate', function() {
                updateProgress(audio);
            });
            
            // Èü≥ÈáèÂà∂Âæ°„ÉÜ„Çπ„Éà
            volumeSlider.addEventListener('input', function() {
                audio.volume = this.value;
                volumeDisplay.textContent = Math.round(this.value * 100) + '%';
                document.getElementById('volumeSupport').textContent = '‚úÖ ÂØæÂøú';
            });
            
            // „Ç´„Çπ„Çø„É†„Ç≥„É≥„Éà„É≠„Éº„É´
            playPauseBtn.addEventListener('click', function() {
                if (audio.paused) {
                    audio.play();
                } else {
                    audio.pause();
                }
            });
            
            stopBtn.addEventListener('click', function() {
                audio.pause();
                audio.currentTime = 0;
                playPauseBtn.textContent = '‚ñ∂Ô∏è ÂÜçÁîü';
            });
            
            rewindBtn.addEventListener('click', function() {
                audio.currentTime = Math.max(0, audio.currentTime - 10);
            });
            
            forwardBtn.addEventListener('click', function() {
                audio.currentTime = Math.min(audio.duration, audio.currentTime + 10);
            });
            
            // „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
            audio.addEventListener('error', function(e) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå „Ç®„É©„Éº: MP3„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü';
                addDebugLog(`ÂÜçÁîü„Ç®„É©„Éº: ${e.message || 'Unknown error'}`);
            });
            
            // È´òÂ∫¶„Å™„ÉÜ„Çπ„Éà„Éú„Çø„É≥
            document.getElementById('testHiddenAudio').addEventListener('click', testHiddenAudio);
            document.getElementById('testMultipleAudio').addEventListener('click', testMultipleAudio);
            document.getElementById('testWebAudio').addEventListener('click', testWebAudioAPI);
            document.getElementById('testPerformance').addEventListener('click', testPerformance);
            
            addDebugLog('ÂàùÊúüÂåñÂÆå‰∫Ü - MP3„ÉÜ„Çπ„ÉàÈñãÂßã');
        });
        
        // „Éö„Éº„Ç∏„ÇíÈõ¢„Çå„ÇãÊôÇ„ÅÆ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
        window.addEventListener('beforeunload', function() {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            if (audioContext) {
                audioContext.close();
            }
        });
    </script>
</body>
</html>
