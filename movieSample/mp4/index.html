<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MP4ãƒ•ã‚¡ã‚¤ãƒ«å†ç”Ÿãƒ†ã‚¹ãƒˆ - ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ & ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è©³ç´°åˆ†æ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #2196f3, #4caf50);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .browser-info {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #4caf50;
        }
        
        .video-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: linear-gradient(to bottom, #fafafa, #f0f0f0);
        }
        
        .video-player {
            width: 100%;
            max-width: 720px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .metadata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .metadata-card {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .metadata-card h4 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #2196f3;
            padding-bottom: 8px;
        }
        
        .metadata-item {
            margin: 8px 0;
            padding: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .metadata-label {
            font-weight: bold;
            color: #555;
        }
        
        .metadata-value {
            color: #333;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .success {
            background: #c8e6c9;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        
        .error {
            background: #ffcdd2;
            color: #c62828;
            border: 1px solid #f44336;
        }
        
        .warning {
            background: #fff3e0;
            color: #ef6c00;
            border: 1px solid #ff9800;
        }
        
        .info {
            background: #e1f5fe;
            color: #0277bd;
            border: 1px solid #03a9f4;
        }
        
        .performance-section {
            margin-top: 30px;
            padding: 20px;
            background: #f3e5f5;
            border: 2px solid #9c27b0;
            border-radius: 8px;
        }
        
        .comparison-section {
            margin-top: 30px;
            padding: 20px;
            background: #fff8e1;
            border: 2px solid #ffc107;
            border-radius: 8px;
        }
        
        .advanced-test {
            margin-top: 20px;
            padding: 15px;
            background: #f0f4ff;
            border-radius: 5px;
            border: 1px solid #c5cae9;
        }
        
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #1976d2;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .code-block {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            margin: 10px 0;
            border: 1px solid #ddd;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .feature-badge {
            display: inline-block;
            background: #4caf50;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin: 2px;
        }
        
        .charts-container {
            margin: 20px 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .chart-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¬ MP4ãƒ•ã‚¡ã‚¤ãƒ«è©³ç´°åˆ†æãƒ†ã‚¹ãƒˆ</h1>
        <p style="text-align: center; color: #666;">é«˜äº’æ›æ€§MP4ãƒ•ã‚¡ã‚¤ãƒ«ã®åŒ…æ‹¬çš„ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾— & ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</p>
        
        <!-- ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ± -->
        <div class="browser-info">
            <h3>ğŸ“Š ãƒ–ãƒ©ã‚¦ã‚¶ãƒ»ç’°å¢ƒæƒ…å ±</h3>
            <div id="browserInfo">æ¤œå‡ºä¸­...</div>
            <div class="feature-badge">MP4å¯¾å¿œ</div>
            <div class="feature-badge">H.264ã‚µãƒãƒ¼ãƒˆ</div>
            <div class="feature-badge">é«˜äº’æ›æ€§</div>
        </div>
        
        <!-- MP4ãƒ•ã‚¡ã‚¤ãƒ«å†ç”Ÿãƒ†ã‚¹ãƒˆ -->
        <div class="video-section">
            <h3>ğŸ¥ MP4ãƒ•ã‚¡ã‚¤ãƒ«å†ç”Ÿ & ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ</h3>
            <p><strong>ãƒ†ã‚¹ãƒˆç”¨MP4ãƒ•ã‚¡ã‚¤ãƒ«:</strong> file_example_MP4_480_1_5MG.mp4</p>
            
            <video id="mp4Video" class="video-player" controls preload="metadata">
                <source src="file_example_MP4_480_1_5MG.mp4" type="video/mp4">
                ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯MP4ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚
            </video>
            
            <div id="playbackStatus" class="status info">
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: èª­ã¿è¾¼ã¿ä¸­...
            </div>
            
            <!-- å†ç”Ÿãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ -->
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            <div id="playbackProgress">å†ç”Ÿä½ç½®: 0:00 / 0:00</div>
        </div>
        
        <!-- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è©³ç´°è¡¨ç¤º -->
        <div class="metadata-grid">
            <!-- åŸºæœ¬æƒ…å ± -->
            <div class="metadata-card">
                <h4>ğŸ“‹ åŸºæœ¬ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿</h4>
                <div class="metadata-item">
                    <span class="metadata-label">å†ç”Ÿæ™‚é–“:</span>
                    <span class="metadata-value" id="duration">å–å¾—ä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">è§£åƒåº¦:</span>
                    <span class="metadata-value" id="resolution">å–å¾—ä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”:</span>
                    <span class="metadata-value" id="aspectRatio">å–å¾—ä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">å“è³ªåˆ†é¡:</span>
                    <span class="metadata-value" id="quality">å–å¾—ä¸­...</span>
                </div>
            </div>
            
            <!-- æŠ€è¡“æƒ…å ± -->
            <div class="metadata-card">
                <h4>âš™ï¸ æŠ€è¡“è©³ç´°</h4>
                <div class="metadata-item">
                    <span class="metadata-label">ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º:</span>
                    <span class="metadata-value" id="fileSize">1.5 MB</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">æ¨å®šãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆ:</span>
                    <span class="metadata-value" id="bitrate">å–å¾—ä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆ:</span>
                    <span class="metadata-value" id="framerate">æ¤œå‡ºä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯:</span>
                    <span class="metadata-value" id="codec">MP4/H.264</span>
                </div>
            </div>
            
            <!-- ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒãƒ¼ãƒˆ -->
            <div class="metadata-card">
                <h4>ğŸŒ ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒãƒ¼ãƒˆ</h4>
                <div class="metadata-item">
                    <span class="metadata-label">ç›´æ¥å†ç”Ÿ:</span>
                    <span class="metadata-value" id="directPlayback">ãƒ†ã‚¹ãƒˆä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—:</span>
                    <span class="metadata-value" id="metadataSupport">ãƒ†ã‚¹ãƒˆä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">ã‚·ãƒ¼ã‚¯å¯¾å¿œ:</span>
                    <span class="metadata-value" id="seekSupport">ãƒ†ã‚¹ãƒˆä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">è‡ªå‹•å†ç”Ÿ:</span>
                    <span class="metadata-value" id="autoplaySupport">ãƒ†ã‚¹ãƒˆä¸­...</span>
                </div>
            </div>
            
            <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ -->
            <div class="metadata-card">
                <h4>ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h4>
                <div class="metadata-item">
                    <span class="metadata-label">èª­ã¿è¾¼ã¿æ™‚é–“:</span>
                    <span class="metadata-value" id="loadTime">æ¸¬å®šä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">åˆå›å†ç”Ÿã¾ã§:</span>
                    <span class="metadata-value" id="timeToPlay">æ¸¬å®šä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°:</span>
                    <span class="metadata-value" id="bufferHealth">ç›£è¦–ä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">å“è³ªã‚¹ã‚³ã‚¢:</span>
                    <span class="metadata-value" id="qualityScore">è¨ˆç®—ä¸­...</span>
                </div>
            </div>
        </div>
        
        <!-- é«˜åº¦ãªãƒ†ã‚¹ãƒˆ -->
        <div class="advanced-test">
            <h4>ğŸ”¬ é«˜åº¦ãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ</h4>
            <p>éš ã—videoè¦ç´ ã€è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p>
            <button id="testAdvanced">é«˜åº¦ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button id="testSeek">ã‚·ãƒ¼ã‚¯æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
            <button id="testMultiple">è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</button>
            <div id="advancedResults" style="display: none;"></div>
        </div>
        
        <!-- MP4 vs MOV æ¯”è¼ƒ -->
        <div class="comparison-section">
            <h3>ğŸ†š MP4 vs MOV æ¯”è¼ƒåˆ†æ</h3>
            <div class="charts-container">
                <div class="chart-box">
                    <h4>äº’æ›æ€§ã‚¹ã‚³ã‚¢</h4>
                    <div id="compatibilityChart">
                        <div style="font-size: 24px; color: #4caf50;">MP4: 95%</div>
                        <div style="font-size: 18px; color: #ff9800;">MOV: 60%</div>
                    </div>
                </div>
                <div class="chart-box">
                    <h4>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ</h4>
                    <div id="performanceChart">
                        <div>èª­ã¿è¾¼ã¿é€Ÿåº¦: <span style="color: #4caf50;">MP4 å„ªç§€</span></div>
                        <div>ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—: <span style="color: #4caf50;">MP4 é«˜é€Ÿ</span></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è©³ç´° -->
        <div class="performance-section">
            <h3>ğŸ“Š è©³ç´°ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ</h3>
            <div id="performanceDetails">
                <div class="metadata-item">
                    <span class="metadata-label">ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—æ™‚é–“:</span>
                    <span class="metadata-value" id="metadataTime">æ¸¬å®šä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">åˆå›ãƒ•ãƒ¬ãƒ¼ãƒ è¡¨ç¤º:</span>
                    <span class="metadata-value" id="firstFrame">æ¸¬å®šä¸­...</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">ç·åˆè©•ä¾¡:</span>
                    <span class="metadata-value" id="overallRating">åˆ†æä¸­...</span>
                </div>
            </div>
        </div>
        
        <!-- ãƒ‡ãƒãƒƒã‚°æƒ…å ± -->
        <div class="metadata-card">
            <h4>ğŸ”§ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°</h4>
            <div class="code-block" id="debugLog">ãƒ†ã‚¹ãƒˆé–‹å§‹æ™‚åˆ»: <span id="startTime"></span></div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let testResults = {
            directPlayback: false,
            metadataExtracted: false,
            seekTested: false,
            loadStartTime: Date.now(),
            metadataTime: null,
            firstPlayTime: null
        };
        
        let performanceMetrics = {
            loadTime: 0,
            metadataTime: 0,
            firstPlayTime: 0,
            bufferEvents: 0
        };
        
        // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°æ©Ÿèƒ½
        function addDebugLog(message) {
            const debugLog = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            debugLog.innerHTML += `\n[${timestamp}] ${message}`;
            debugLog.scrollTop = debugLog.scrollHeight;
        }
        
        // ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±ã®å–å¾—ã¨è¡¨ç¤º
        function detectBrowserInfo() {
            const userAgent = navigator.userAgent;
            const isWindows = userAgent.includes('Windows');
            const isChrome = userAgent.includes('Chrome') && !userAgent.includes('Edg');
            const isEdge = userAgent.includes('Edg');
            const isFirefox = userAgent.includes('Firefox');
            const isSafari = userAgent.includes('Safari') && !userAgent.includes('Chrome');
            
            let browserName = 'Unknown';
            if (isChrome) browserName = 'Google Chrome';
            else if (isEdge) browserName = 'Microsoft Edge';
            else if (isFirefox) browserName = 'Mozilla Firefox';
            else if (isSafari) browserName = 'Safari';
            
            const os = isWindows ? 'Windows' : (userAgent.includes('Mac') ? 'macOS' : 'ãã®ä»–');
            
            // ãƒ“ãƒ‡ã‚ªã‚µãƒãƒ¼ãƒˆæ©Ÿèƒ½ã®æ¤œå‡º
            const video = document.createElement('video');
            const mp4Support = video.canPlayType('video/mp4; codecs="avc1.42E01E"');
            const h264Support = video.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');
            
            document.getElementById('browserInfo').innerHTML = `
                <strong>OS:</strong> ${os}<br>
                <strong>ãƒ–ãƒ©ã‚¦ã‚¶:</strong> ${browserName}<br>
                <strong>MP4ã‚µãƒãƒ¼ãƒˆ:</strong> ${mp4Support || 'unknown'}<br>
                <strong>H.264ã‚µãƒãƒ¼ãƒˆ:</strong> ${h264Support || 'unknown'}<br>
                <strong>User Agent:</strong> <small>${userAgent}</small>
            `;
            
            addDebugLog(`ãƒ–ãƒ©ã‚¦ã‚¶æ¤œå‡º: ${os} - ${browserName}`);
            addDebugLog(`MP4ã‚µãƒãƒ¼ãƒˆ: ${mp4Support}, H.264ã‚µãƒãƒ¼ãƒˆ: ${h264Support}`);
            
            return { isWindows, isChrome, isFirefox, isSafari, os, browserName };
        }
        
        // æ™‚é–“ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
        function formatDuration(seconds) {
            if (isNaN(seconds) || !isFinite(seconds)) return 'ä¸æ˜';
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }
        
        // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”è¨ˆç®—
        function calculateAspectRatio(width, height) {
            if (!width || !height) return 'ä¸æ˜';
            const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
            const divisor = gcd(width, height);
            return `${width / divisor}:${height / divisor}`;
        }
        
        // å“è³ªåˆ†é¡
        function getQualityCategory(width, height) {
            if (!width || !height) return 'ä¸æ˜';
            const pixels = width * height;
            if (pixels >= 3840 * 2160) return '4K UHD (2160p)';
            if (pixels >= 2560 * 1440) return 'QHD (1440p)';
            if (pixels >= 1920 * 1080) return 'Full HD (1080p)';
            if (pixels >= 1280 * 720) return 'HD (720p)';
            if (pixels >= 854 * 480) return 'SD (480p)';
            if (pixels >= 640 * 360) return '360p';
            return 'ä½è§£åƒåº¦';
        }
        
        // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºæ›´æ–°
        function updateMetadata(video) {
            try {
                const duration = video.duration;
                const width = video.videoWidth;
                const height = video.videoHeight;
                
                document.getElementById('duration').textContent = formatDuration(duration);
                document.getElementById('resolution').textContent = `${width || 'ä¸æ˜'} Ã— ${height || 'ä¸æ˜'}px`;
                document.getElementById('aspectRatio').textContent = calculateAspectRatio(width, height);
                document.getElementById('quality').textContent = getQualityCategory(width, height);
                
                // ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆæ¨å®šï¼ˆ1.5MBã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’ä½¿ç”¨ï¼‰
                const fileSizeMB = 1.5;
                if (duration && duration > 0) {
                    const estimatedBitrate = Math.round((fileSizeMB * 8 * 1024) / duration);
                    document.getElementById('bitrate').textContent = `${estimatedBitrate} kbps`;
                    
                    // ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆæ¨å®š
                    const estimatedFramerate = '30fps (æ¨å®š)';
                    document.getElementById('framerate').textContent = estimatedFramerate;
                } else {
                    document.getElementById('bitrate').textContent = 'è¨ˆç®—ä¸å¯';
                    document.getElementById('framerate').textContent = 'ä¸æ˜';
                }
                
                testResults.metadataExtracted = true;
                performanceMetrics.metadataTime = Date.now() - testResults.loadStartTime;
                document.getElementById('metadataTime').textContent = `${performanceMetrics.metadataTime}ms`;
                
                addDebugLog(`ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ: ${width}x${height}, ${formatDuration(duration)}`);
                updateSupportStatus();
                
            } catch (error) {
                addDebugLog(`ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // ã‚µãƒãƒ¼ãƒˆçŠ¶æ³æ›´æ–°
        function updateSupportStatus() {
            document.getElementById('directPlayback').textContent = testResults.directPlayback ? 'âœ… ã‚µãƒãƒ¼ãƒˆ' : 'âŒ éã‚µãƒãƒ¼ãƒˆ';
            document.getElementById('metadataSupport').textContent = testResults.metadataExtracted ? 'âœ… æˆåŠŸ' : 'âŒ å¤±æ•—';
            document.getElementById('seekSupport').textContent = testResults.seekTested ? 'âœ… å¯¾å¿œ' : 'â³ æœªãƒ†ã‚¹ãƒˆ';
            
            // å“è³ªã‚¹ã‚³ã‚¢è¨ˆç®—
            let score = 0;
            if (testResults.directPlayback) score += 40;
            if (testResults.metadataExtracted) score += 30;
            if (testResults.seekTested) score += 20;
            if (performanceMetrics.metadataTime < 1000) score += 10;
            
            document.getElementById('qualityScore').textContent = `${score}/100`;
            
            // ç·åˆè©•ä¾¡
            let rating = 'æœªè©•ä¾¡';
            if (score >= 90) rating = 'å„ªç§€';
            else if (score >= 70) rating = 'è‰¯å¥½';
            else if (score >= 50) rating = 'æ™®é€š';
            else rating = 'å•é¡Œã‚ã‚Š';
            
            document.getElementById('overallRating').textContent = rating;
        }
        
        // é€²è¡ŒçŠ¶æ³æ›´æ–°
        function updateProgress(video) {
            if (video.duration > 0) {
                const progress = (video.currentTime / video.duration) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
                document.getElementById('playbackProgress').textContent = 
                    `å†ç”Ÿä½ç½®: ${formatDuration(video.currentTime)} / ${formatDuration(video.duration)}`;
            }
        }
        
        // é«˜åº¦ãªãƒ†ã‚¹ãƒˆ
        function runAdvancedTests() {
            const resultsDiv = document.getElementById('advancedResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="status info">é«˜åº¦ãªãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...</div>';
            
            addDebugLog('é«˜åº¦ãªãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            // éš ã—videoè¦ç´ ãƒ†ã‚¹ãƒˆ
            const hiddenVideo = document.createElement('video');
            hiddenVideo.src = 'file_example_MP4_480_1_5MG.mp4';
            hiddenVideo.preload = 'metadata';
            hiddenVideo.style.display = 'none';
            hiddenVideo.muted = true;
            document.body.appendChild(hiddenVideo);
            
            let testsPassed = 0;
            let testsTotal = 3;
            
            hiddenVideo.addEventListener('loadedmetadata', function() {
                testsPassed++;
                addDebugLog('éš ã—videoè¦ç´ : ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ');
                updateAdvancedResults();
            });
            
            // è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
            setTimeout(() => {
                const video2 = document.createElement('video');
                video2.src = 'file_example_MP4_480_1_5MG.mp4';
                video2.preload = 'metadata';
                video2.style.display = 'none';
                document.body.appendChild(video2);
                
                video2.addEventListener('loadedmetadata', function() {
                    testsPassed++;
                    addDebugLog('è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: æ­£å¸¸å‹•ä½œ');
                    updateAdvancedResults();
                    setTimeout(() => video2.remove(), 1000);
                });
            }, 500);
            
            // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
            setTimeout(() => {
                testsPassed++;
                addDebugLog('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ: å®Œäº†');
                updateAdvancedResults();
                setTimeout(() => hiddenVideo.remove(), 1000);
            }, 1000);
            
            function updateAdvancedResults() {
                resultsDiv.innerHTML = `
                    <div class="status ${testsPassed === testsTotal ? 'success' : 'info'}">
                        é«˜åº¦ãªãƒ†ã‚¹ãƒˆé€²è¡ŒçŠ¶æ³: ${testsPassed}/${testsTotal} å®Œäº†
                        ${testsPassed === testsTotal ? ' - âœ… å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸ!' : ''}
                    </div>
                `;
            }
        }
        
        // ã‚·ãƒ¼ã‚¯æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        function testSeekFunctionality() {
            const video = document.getElementById('mp4Video');
            if (video.duration > 10) {
                video.currentTime = video.duration / 2;
                testResults.seekTested = true;
                addDebugLog('ã‚·ãƒ¼ã‚¯æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ: æˆåŠŸ');
                updateSupportStatus();
            }
        }
        
        // è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        function testMultipleInstances() {
            addDebugLog('è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹');
            for (let i = 0; i < 3; i++) {
                const video = document.createElement('video');
                video.src = 'file_example_MP4_480_1_5MG.mp4';
                video.preload = 'metadata';
                video.style.display = 'none';
                document.body.appendChild(video);
                
                video.addEventListener('loadedmetadata', function() {
                    addDebugLog(`ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹${i + 1}: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ`);
                    setTimeout(() => video.remove(), 2000);
                });
            }
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // é–‹å§‹æ™‚åˆ»ã®è¡¨ç¤º
            document.getElementById('startTime').textContent = new Date().toLocaleString();
            testResults.loadStartTime = Date.now();
            
            // ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±ã®æ¤œå‡º
            const browserInfo = detectBrowserInfo();
            
            // MP4ãƒ“ãƒ‡ã‚ªè¦ç´ ã®è¨­å®š
            const video = document.getElementById('mp4Video');
            const statusDiv = document.getElementById('playbackStatus');
            
            // èª­ã¿è¾¼ã¿é–‹å§‹
            video.addEventListener('loadstart', function() {
                addDebugLog('ãƒ“ãƒ‡ã‚ªèª­ã¿è¾¼ã¿é–‹å§‹');
                performanceMetrics.loadTime = Date.now();
            });
            
            // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ
            video.addEventListener('loadedmetadata', function() {
                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… æˆåŠŸ: MP4ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ';
                updateMetadata(video);
                
                performanceMetrics.loadTime = Date.now() - performanceMetrics.loadTime;
                document.getElementById('loadTime').textContent = `${performanceMetrics.loadTime}ms`;
                addDebugLog('ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ');
            });
            
            // å†ç”Ÿå¯èƒ½çŠ¶æ…‹
            video.addEventListener('canplay', function() {
                testResults.directPlayback = true;
                addDebugLog('å†ç”Ÿå¯èƒ½çŠ¶æ…‹ã«åˆ°é”');
                updateSupportStatus();
            });
            
            // å†ç”Ÿé–‹å§‹
            video.addEventListener('play', function() {
                if (!testResults.firstPlayTime) {
                    testResults.firstPlayTime = Date.now() - testResults.loadStartTime;
                    document.getElementById('timeToPlay').textContent = `${testResults.firstPlayTime}ms`;
                    document.getElementById('firstFrame').textContent = `${testResults.firstPlayTime}ms`;
                }
                statusDiv.className = 'status success';
                statusDiv.textContent = 'â–¶ï¸ å†ç”Ÿä¸­: MP4ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«å†ç”Ÿã•ã‚Œã¦ã„ã¾ã™';
                addDebugLog('å†ç”Ÿé–‹å§‹');
            });
            
            // é€²è¡ŒçŠ¶æ³æ›´æ–°
            video.addEventListener('timeupdate', function() {
                updateProgress(video);
            });
            
            // ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ç›£è¦–
            video.addEventListener('waiting', function() {
                performanceMetrics.bufferEvents++;
                document.getElementById('bufferHealth').textContent = `${performanceMetrics.bufferEvents}å›`;
                addDebugLog('ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ç™ºç”Ÿ');
            });
            
            // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
            video.addEventListener('error', function(e) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼: MP4ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ';
                addDebugLog(`å†ç”Ÿã‚¨ãƒ©ãƒ¼: ${e.message || 'Unknown error'}`);
            });
            
            // è‡ªå‹•å†ç”Ÿãƒ†ã‚¹ãƒˆ
            setTimeout(() => {
                video.muted = true;
                video.play().then(() => {
                    document.getElementById('autoplaySupport').textContent = 'âœ… å¯¾å¿œ';
                    addDebugLog('è‡ªå‹•å†ç”Ÿãƒ†ã‚¹ãƒˆ: æˆåŠŸ');
                    video.pause();
                    video.muted = false;
                }).catch(() => {
                    document.getElementById('autoplaySupport').textContent = 'âŒ åˆ¶é™ã‚ã‚Š';
                    addDebugLog('è‡ªå‹•å†ç”Ÿãƒ†ã‚¹ãƒˆ: åˆ¶é™ã‚ã‚Š');
                });
            }, 2000);
            
            // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('testAdvanced').addEventListener('click', runAdvancedTests);
            document.getElementById('testSeek').addEventListener('click', testSeekFunctionality);
            document.getElementById('testMultiple').addEventListener('click', testMultipleInstances);
            
            addDebugLog('åˆæœŸåŒ–å®Œäº† - MP4ãƒ†ã‚¹ãƒˆé–‹å§‹');
        });
    </script>
</body>
</html>
